<style>
#ball {
    background: blue;
    border-radius: 20px;
    width: 20px;
    height: 20px;
    position: absolute;
    left: 10px;
    top: 10px;
}
#track {
    background: rgba(0, 0, 0, 0.1);
    box-shadow: inset 2px 2px 2px 1px rgba(0, 0, 0, 0.1);
    border-radius: 20px;
    width: calc(100% - 20px);
    height: 20px;
    position: absolute;
    left: 10px;
    top: 10px;
}
#notch {
    border: solid 4px transparent;
    border-top-color: black;
    width: 0;
    height: 0;
    position: absolute;
    left: calc(15px + (100% - 40px) * 0.618);
    top: 6px;
}
#input {
    position: absolute;
    top: 40px;
    width: 240px;
}
#output {
    position: absolute;
    top: 40px;
    left: 250px;
    margin-top: 5px;
}
#keyboardShortcuts {
    position: absolute;
    top: 40px;
    right: 40px;
}
</style>
<div id="track"></div>
<div id="notch"></div>
<div id="ball"></div>

<textarea id="input" rows="16" wrap="off"></textarea>
<pre id="output"></pre>
<pre id="keyboardShortcuts">Keyboard shortcuts:

</pre>

<script src="web-animations.js"></script>
<script>
var player = ball.animate({left: 'calc(100% - 30px)'}, 1.618).player;

input.value = [
    'player.timeline.currentTime',
    'player.currentTime',
    'player.currentTime > 1.618',
    'player.timeLag',
    'player._storedTimeLag',
    'player._pauseTimeLag',
    'player._pauseStartTime',
    'player.paused',
    'player.playing',
    'player.playbackRate',
    'player.source === null',
].join('\n');

var intervalId = null;
function toggleLogging() {
    if (intervalId === null) {
        intervalId = setInterval(function() {
            var text = '';
            input.value.split('\n').forEach(function(line) {
                try {
                    if (line) {
                        text += eval(line);
                    }
                } catch (_) {
                } finally {
                    text += '\n';
                }
            })
            output.textContent = text;
        }, 50);
    } else {
        clearInterval(intervalId);
        intervalId = null
    }
}
toggleLogging();

var controls = {
    192: {help: '~: Seek to -1s', action: function() { player.currentTime = -1; }},
    49: {help: '1: Seek to 1s', action: function() { player.currentTime = 1; }},
    51: {help: '3: Seek to 3s', action: function() { player.currentTime = 3; }},
    67: {help: 'C: Cancel player', action: function() { player.cancel(); }},
    70: {help: 'F: Finish player', action: function() { player.finish(); }},
    76: {help: 'L: Toggle logging', action: function() { toggleLogging(); }},
    80: {help: 'P: Play', action: function() { player.play(); }},
    32: {help: 'Space: Pause', action: function() { player.pause(); }},
    82: {help: 'R: Reverse', action: function() { player.reverse(); }},
    107: {help: '+: Speed up', action: function() { player.playbackRate *= 2; }},
    109: {help: '-: Slow down', action: function() { player.playbackRate /= 2; }},
}

for (var i in controls) {
    keyboardShortcuts.textContent += controls[i].help + '\n';
}

window.addEventListener('keydown', function(event) {
    if (event.keyCode in controls) {
        controls[event.keyCode].action();
    }
    // console.log(event.keyCode);
});

input.addEventListener('keydown', function(event) {
    event.stopPropagation();
});
</script>
